/*
 Copyright 2015 SLI Systems v2.0
 Copyright 2008, 2014 jQuery Foundation, Inc. and other contributors
 @license Released under the MIT license http://jquery.org/license
 @param {Element} elem
 @return {string} the element text
 Tyson Matanich 2013
 @license MIT
 @see {@link https://github.com/tysonmatanich/viewportSize/blob/master/viewportSize.js}
 Copyright 2008, 2014 jQuery Foundation, Inc. and other contributors
 @license Released under the MIT license http://jquery.org/license
 @constructor
 @param {string} url URL to load script from
 Copyright 2008, 2014 jQuery Foundation, Inc. and other contributors
 @license Released under the MIT license http://jquery.org/license
*/
(function(f,g){function s(a){return function(c){var b=c.relatedTarget;b&&(this===b||this.contains(b))||a.call(this,c)}}function z(a){a.target||(a.target=a.srcElement||g);a.preventDefault||(a.preventDefault=function(){a.returnValue=!1});a.stopPropagation||(a.stopPropagation=function(){a.cancelBubble=!1});return a}function t(a){var c="",b=a.nodeType;if(1===b||9===b||11===b){if("string"===typeof a.textContent)return a.textContent;for(a=a.firstChild;a;a=a.nextSibling)c+=t(a)}else if(3===b||4===b)return a.nodeValue;
return c}function A(a,c){var b=a.style,d=b.visibility,e=b.display;b.visibility="hidden";b.display="block";c(a);b.visibility=d;b.display=e}function u(a){var c=!1,b=f.requestAnimationFrame||f.mozRequestAnimationFrame||f.webkitRequestAnimationFrame,d=function(){a();c=!1};return b?function(){c||(c=!0,b(d))}:function(){c||(c=!0,setTimeout(d,66))}}function B(){var a=g.documentElement;if("innerWidth"in f){if(f.innerWidth!=a.clientWidth){var c=g.createElement("body");c.id="vpw-test-b";c.style.cssText="overflow:scroll";
var b=g.createElement("div");b.id="vpw-test-d";b.style.cssText="position:absolute;top:-1000px";b.innerHTML="<style>@media(width:"+a.clientWidth+"px){body#vpw-test-b div#vpw-test-d{width:7px!important}}</style>";c.appendChild(b);a.insertBefore(c,g.head);b=7==b.offsetWidth?a.clientWidth:f.innerWidth;a.removeChild(c);return b}return f.innerWidth}return a.clientWidth}function v(a){return(a||"").replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"").replace(/\s{2,}/g," ")}function w(a){var c=this,b=g.head||
g.getElementsByTagName("head")[0]||g.documentElement,d=this.script=g.createElement("script");d.async=!0;d.src=a;d.onload=d.onreadystatechange=function(a,b){if(b||!d.readyState||/loaded|complete/.test(d.readyState))d.onload=d.onreadystatechange=null,d.parentNode&&d.parentNode.removeChild(d),c.script=null};b.appendChild(d)}function x(a){if(a)this.init(a);else throw"need rich autocomplete settings";this.urls=[];var c=this.inputs=[],b=this.createElement(),d=b.style,e=g.querySelectorAll("[data-provide=rac]");
a=[];for(var q=0,l=e.length;q<l;++q){var k=new y(e[q],this);c.push(k);k.isFixed&&a.push(k.el)}var m=this.selectCurrent.bind(this);h(b,"click",function(){setTimeout(m,50)});h(b,"mouseleave",this.resetActive.bind(this));switch(this.width){case "auto":break;case "mobile":this.resize=function(){var a=f.orientation;d.width=0===a||180==a?"100%":this.input?this.input.el.offsetWidth-2+"px":this.defaults.width};break;case "parent":this.resize=function(){var a=this.input;a&&(d.width=a.el.offsetWidth-2+"px")};
break;default:c=parseInt(this.width,10),"number"!==typeof c&&(c=this.defaults.width),d.width=c+"px"}var n=function(){this.resize&&this.resize();this.position();this.checkBreakPoint()},n=n.bind(this);h(f,"resize",u(n));h(f,"orientationchange",n);a.length&&(this.fixed=a,h(f,"scroll",u(function(){var a=this.input;a&&this.isVisible&&this.fixed&&!(0>this.fixed.indexOf(a.el))&&(0===a.el.offsetWidth?this.hide(a.el):n())}.bind(this))));this.checkBreakPoint()}function y(a,c,b){this.el=a;this.autocomplete=
c;b&&b.delay&&(this.delay=b.delay);a.setAttribute("autocomplete","off");this.isFixed="fixed"===a.getAttribute("data-sli-position");a.hasAttribute("data-sli-width")&&(this.width=a.getAttribute("data-sli-width"));var d=this._onBlur.bind(this),e=this.delay+800;h(a,"blur",function(){setTimeout(d,e)});h(a,"focus",this._onFocus.bind(this));h(a,"keydown",this._onKeyDown.bind(this));f.opera&&opera.version&&(c=opera.version())&&11>c&&(a.onkeypress=this._onKeyPress.bind(this));h(a,"keyup",this._onKeyUp.bind(this));
h(a,"compositionupdate",this._onCompositionUpdate.bind(this));h(a,"compositionend",this._onCompositionEnd.bind(this))}var C=f.SLI=f.SLI||{},D=/([.*+?^=!:${}()|[\]\/\\])/g;Function.prototype.bind||(Function.prototype.bind=function(a){function c(){}if("function"!==typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var b=[].slice,d=b.call(arguments,1),e=this,g=function(){return e.apply(this instanceof c?this:a||f,d.concat(b.call(arguments)))};c.prototype=
this.prototype;g.prototype=new c;return g});Array.prototype.indexOf||(Array.prototype.indexOf=function(a){var c=Object(this),b=c.length>>>0;if(0===b)return-1;var d=0;1<arguments.length&&(d=Number(arguments[1]),d!=d?d=0:0!==d&&Infinity!=d&&-Infinity!=d&&(d=(0<d||-1)*Math.floor(Math.abs(d))));if(d>=b)return-1;for(d=0<=d?d:Math.max(b-Math.abs(d),0);d<b;d++)if(d in c&&c[d]===a)return d;return-1});var r=function(){return"classList"in g.documentElement?function(a,c){a.classList.add(c)}:function(a,c){(new RegExp("(?:^|\\b)"+
c+"(?:\\b|$)","gi")).test(a.className)||(a.className+=" "+c)}}(),p=function(){return"classList"in g.documentElement?function(a,c){a.classList.remove(c)}:function(a,c){var b=a.className,d=b.replace(new RegExp("(?:^|\\b)"+c+"(?:\\b|$)","gi")," ");d!==b&&(a.className=d)}}(),h=function(){if(Element.prototype.addEventListener){var a=g.documentElement;return"onmouseenter"in a&&"onmouseleave"in a?function(a,b,d){a.addEventListener(b,d)}:function(a,b,d){"mouseenter"===b?(b="mouseover",d=s(d)):"mouseleave"===
b&&(b="mouseout",d=s(d));a.addEventListener(b,d)}}return function(a,b,d){a.attachEvent("on"+b,function(b){d.call(a,z(b||f.event))})}}(),E=function(){var a=g.body,c=this.getBoundingClientRect();f.scrollTo(c.left+a.scrollLeft,c.top+a.scrollTop-5)};w.prototype.abort=function(){var a=this.script;if(a)a.onload(void 0,!0)};x.prototype={id:"sli_autocomplete",tagName:"ul",activeClass:"sli_ac_active",dropdownClass:"sli_ac_dropdown",zIndex:3E4,width:"parent",base:"",params:"/search?ts=rac&w=",mobile:!1,defaults:{width:420},
offsetLeft:0,offsetTop:0,align:"left",maxSearchLength:100,isVisible:!1,selector:"li li",focus:!1,currentSelected:-1,value:void 0,request:null,input:null,type:null,resize:null,breakpoints:{mobile:{maxWidth:767,value:"m"},other:{maxWidth:void 0,value:"o"}},valueStop:"",stopQuery:!1,init:function(a){var c,b;if(a.selector)this.selector=a.selector;else throw"selector not specified";a.mobile&&(this.mobile=!!a.mobile,this.params=this.params.replace(/([?&]ts=[^&]*)/,"$1mobile"));(c=f.sli)&&c.global&&c.global.base&&
(this.base=c.global.base);a.params&&(this.params=a.params);a.base&&(this.base=a.base.replace(/\/+$/,"")+this.params);var d="tagName activeClass dropdownClass offsetLeft offsetTop width align maxSearchLength zIndex".split(" ");c=0;for(b=d.length;c<b;++c){var e=d[c];e in a&&(this[e]=a[e])}d=["onSelect","onShow","preRequest","postRequest","itemSelected"];c=0;for(b=d.length;c<b;++c)e=d[c],e in a&&"function"===typeof a[e]&&(this[e]=a[e])},createElement:function(){var a=this.el=g.createElement(this.tagName);
a.id=this.id;a.className="rich";var c=a.style;c.display="none";c.zIndex=this.zIndex;g.body.appendChild(a);return a},setInput:function(a){if(this.input!==a||this.fixed&&0<=this.fixed.indexOf(a.el))this.input=a,this.resize&&this.resize(),this.position()},position:function(){var a=this.input;if(a){var a=a.el,c=this.fixed&&0<=this.fixed.indexOf(a),b=g.documentElement,d=g.body,e=a.getBoundingClientRect(),h=e.top+a.offsetHeight+this.offsetTop,e=e.left+this.offsetLeft,l=this.el,k=l.style;c||(h+="undefined"!=
typeof f.pageYOffset?f.pageYOffset:b.scrollTop?b.scrollTop:d.scrollTop?d.scrollTop:0,e+="undefined"!=typeof f.pageXOffset?f.pageXOffset:b.scrollLeft?b.scrollLeft:d.scrollLeft?d.scrollLeft:0);if("right"===this.align){var m=l.offsetWidth;0===m&&"none"===k.display&&A(l,function(){m=l.offsetWidth});e+=a.offsetWidth-m}k.top=h+"px";k.left=e+"px";k.position=c?"fixed":"absolute"}},_select:function(a){var c=this.items,b=this.currentSelected;this.currentSelected=a;b!==a&&0<=b&&b<c.length&&p(c[b],this.activeClass);
a=c[a];r(a,this.activeClass);this.itemSelected&&this.itemSelected(a)},moveSelect:function(a){var c=this.items.length-1;a=this.currentSelected+a;0>a?a=0:a>c&&(a=c);this._select(a)},next:function(){this.moveSelect(1)},prev:function(){this.moveSelect(-1)},pageDown:function(){this.moveSelect(10)},pageUp:function(){this.moveSelect(-10)},show:function(){var a=this.el,c;!this.isVisible&&this.onShow&&(c=this.onShow(a));!1!==c&&(a.style.display="block",this.isVisible=!0,this.input&&r(this.input.el,this.dropdownClass))},
hide:function(a){this.el.style.display="none";this.isVisible=!1;a&&p(a.el,this.dropdownClass)},selectCurrent:function(){var a=this.currentSelected;if(0>a||a>this.urls.length)return!1;var c=this.input.el,b=c.value,d=this.urls[a]+"&asug="+encodeURIComponent(b),b={url:d,query:b};0<=d.indexOf("rt=racsug")?b.type="suggestion":0<=d.indexOf("rt=racclick")&&(b.type="product");this.onSelect&&(b=this.onSelect(b));if(!b)return!1;a=this.items[a];c&&a&&(a=a.getElementsByClassName?a.getElementsByClassName("sli_ac_sugg")[0]:
a.querySelector(".sli_ac_sugg"))&&(c.value=v(t(a)));this.hide(this.input);g.location=b.url+(b.url.match(/[#?]/)?"&":"?")+"apelog=yes";return!0},_mouseOver:function(a){var c=this.currentSelected;0>a||a===c||!this.isVisible||this._select(a)},stopRequest:function(){null!==this.request&&this.request.abort()},addData:function(a,c){if(this.focus){if(this.postRequest){var b=this.postRequest({url:a,html:c});a=b.url;c=b.html}for(var b=c,d=this.value.split(/\s+/),e=0,f=d.length;e<f;++e)var g=d[e].replace(D,
"\\$1"),b=b.replace(new RegExp("(>|\\s)("+g+")(?=[^>]*<(?!/h2))","gi"),"$1<b>$2</b>");this.urls=a;this.el.innerHTML=b;if(this.items)for(b=this.items,d=0,e=b.length;d<e;++d)b[d].onmouseover=null;b=this.items=this.el.querySelectorAll(this.selector);d=0;for(e=b.length;d<e;++d)b[d].onmouseover=this._mouseOver.bind(this,d);this.currentSelected=-1;1>this.urls.length?(this.hide(this.input),this.valueStop=this.value,this.stopQuery=!0):(this.show(),this.valueStop="",this.stopQuery=!1)}},doRequest:function(a){var c=
this.valueStop;return a.length>this.maxSearchLength?!1:a==this.value?(0<this.urls.length&&this.show(),!1):this.stopQuery&&a.length>c.length&&a.substr(0,c.length)==c?!1:!0},outOfFocus:function(a){this.focus=!1;this.hide(a);this.resetActive()},fireRequest:function(){this.stopRequest();var a=this.base+encodeURIComponent(this.value)+"&rt=rac&dv="+this.type,a=this.preRequest?this.preRequest(a):a;this.request=new w(a)},resetActive:function(){var a=this.currentSelected,c=this.items;0<=a&&a<c.length&&p(c[a],
this.activeClass);this.currentSelected=-1},valueChanged:function(a,c){this.setInput(a);this.doRequest(c)&&(this.value=c,0===c.length?(this.stopRequest(),this.hide(a)):this.fireRequest())},inFocus:function(a){this.resetActive();this.focus=!0;a!==this.input?(this.hide(this.input),this.setInput(a)):0<this.urls.length&&a&&a.el&&0<a.el.value.length&&this.show();this.mobile&&setTimeout(E.bind(a.el),10)},checkBreakPoint:function(){var a=this.breakpoints,c=B()<a.mobile.maxWidth?a.mobile.value:a.other.value;
c!==this.type&&(this.type=c,(c===a.mobile.value?r:p)(this.el,"mobile"),this.isVisible&&this.value&&0<this.value.length&&this.fireRequest())}};y.prototype={delay:150,isFixed:!1,lastValue:"",timeout:null,isCompositionEnd:!1,blockSubmit:!1,_onChange:function(a){a&&"string"===typeof a||(a=this.el.value);this.autocomplete.valueChanged(this,v(a))},_onBlur:function(){this.autocomplete.outOfFocus(this)},_onFocus:function(){this.autocomplete.inFocus(this)},_onKeyPress:function(){if(this.blockSubmit&&(this.blockSubmit=
!1,this.autocomplete.isVisible))return!1},_onKeyDown:function(a){var c=this.el,b=this.autocomplete;b.focus=!0;this.blockSubmit=!1;switch(null!=a.which?a.which:null!=a.charCode?a.charCode:a.keyCode){case 38:a.preventDefault();b.isVisible?b.prev():this._onChange();break;case 40:a.preventDefault();b.isVisible?b.next():this._onChange();break;case 33:a.preventDefault();b.isVisible?b.pageUp():this._onChange();break;case 34:a.preventDefault();b.isVisible?b.pageDown():this._onChange();break;case 9:case 13:if(b.selectCurrent())return a.preventDefault(),
this.blockSubmit=!1;b.stopRequest();null!==this.timeout&&clearTimeout(this.timeout);this.lastValue=c.value;this.isCompositionEnd||b.hide(this);break;case 27:b.hide(this);break;default:b.resetActive(),clearTimeout(this.timeout)}this.lastValue=c.value},_onKeyUp:function(a){switch(null!=a.which?a.which:null!=a.charCode?a.charCode:a.keyCode){case 27:case 9:case 13:this.isCompositionEnd?this.isCompositionEnd=!1:this.autocomplete.hide(this);break;default:clearTimeout(this.timeout),this.el.value!=this.lastValue&&
(this.timeout=setTimeout(this._onChange.bind(this),this.delay))}},_onCompositionUpdate:function(a){a=a.data;a!==this.lastValue&&(clearTimeout(this.timeout),this.timeout=setTimeout(this._onChange.bind(this,a),this.delay))},_onCompositionEnd:function(){this.isCompositionEnd=!0}};C.Autocomplete=x})(window,document);
